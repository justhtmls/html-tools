<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 转 HTML</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(48, 207, 208, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .editor-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .editor-title {
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }

        .editor-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            border-color: #30cfd0;
        }

        .editor-textarea {
            width: 100%;
            flex: 1;
            min-height: 500px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            transition: border-color 0.3s;
        }

        .editor-textarea:focus {
            outline: none;
            border-color: #30cfd0;
        }

        .preview-content {
            flex: 1;
            min-height: 500px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            overflow-y: auto;
        }

        /* Markdown preview styles */
        .preview-content h1 { font-size: 2em; margin: 0.67em 0; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
        .preview-content h2 { font-size: 1.5em; margin: 0.75em 0; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
        .preview-content h3 { font-size: 1.25em; margin: 0.83em 0; }
        .preview-content h4 { font-size: 1em; margin: 1em 0; }
        .preview-content p { margin: 1em 0; line-height: 1.6; }
        .preview-content ul, .preview-content ol { margin: 1em 0; padding-left: 2em; }
        .preview-content li { margin: 0.5em 0; }
        .preview-content code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 0.9em; }
        .preview-content pre { background: #282c34; color: #abb2bf; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 1em 0; }
        .preview-content pre code { background: none; padding: 0; color: inherit; }
        .preview-content blockquote { border-left: 4px solid #ddd; margin: 1em 0; padding-left: 1em; color: #666; }
        .preview-content a { color: #30cfd0; text-decoration: none; }
        .preview-content a:hover { text-decoration: underline; }
        .preview-content img { max-width: 100%; }
        .preview-content table { border-collapse: collapse; width: 100%; margin: 1em 0; }
        .preview-content th, .preview-content td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
        .preview-content th { background: #f4f4f4; }
        .preview-content hr { border: none; border-top: 1px solid #eee; margin: 2em 0; }

        @media (max-width: 900px) {
            .editor-container {
                grid-template-columns: 1fr;
            }

            .editor-textarea,
            .preview-content {
                min-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Markdown 转 HTML</h1>
            <p>实时将 Markdown 转换为 HTML 并预览</p>
        </div>

        <div class="card">
            <div class="action-bar">
                <div>
                    <button class="btn" onclick="loadExample()">加载示例</button>
                    <button class="btn btn-secondary" onclick="clearAll()">清空</button>
                </div>
                <div>
                    <button class="btn" onclick="copyHTML()">复制 HTML</button>
                    <button class="btn btn-secondary" onclick="downloadHTML()">下载 HTML</button>
                </div>
            </div>

            <div class="editor-container">
                <div class="editor-panel">
                    <div class="editor-header">
                        <span class="editor-title">Markdown 输入</span>
                        <div class="editor-actions">
                            <button class="icon-btn" onclick="pasteMarkdown()">粘贴</button>
                            <button class="icon-btn" onclick="document.getElementById('markdown-input').value=''">清空</button>
                        </div>
                    </div>
                    <textarea class="editor-textarea" id="markdown-input" placeholder="# 在此输入 Markdown...

## 示例

- 列表项 1
- 列表项 2

**粗体** 和 *斜体*

`代码`

[链接](https://example.com)
" oninput="convert()"></textarea>
                </div>

                <div class="editor-panel">
                    <div class="editor-header">
                        <span class="editor-title">HTML 预览</span>
                        <div class="editor-actions">
                            <button class="icon-btn" onclick="copyHTML()">复制</button>
                        </div>
                    </div>
                    <div class="preview-content" id="html-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function convert() {
            const markdown = document.getElementById('markdown-input').value;
            const html = parseMarkdown(markdown);
            document.getElementById('html-preview').innerHTML = html;
        }

        function parseMarkdown(markdown) {
            let html = markdown;

            // 代码块（需要先处理，避免被其他规则干扰）
            html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, function(match, lang, code) {
                return '<pre><code class="language-' + (lang || '') + '">' + escapeHtml(code.trim()) + '</code></pre>';
            });

            // 行内代码
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

            // 标题
            html = html.replace(/^#### (.+)$/gm, '<h4>$1</h4>');
            html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
            html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
            html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');

            // 粗体和斜体
            html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
            html = html.replace(/___(.+?)___/g, '<strong><em>$1</em></strong>');
            html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');
            html = html.replace(/_(.+?)_/g, '<em>$1</em>');

            // 删除线
            html = html.replace(/~~(.+?)~~/g, '<del>$1</del>');

            // 链接
            html = html.replace(/\[([^\]]+)\]\(([^\)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

            // 图片
            html = html.replace(/!\[([^\]]*)\]\(([^\)]+)\)/g, '<img src="$2" alt="$1">');

            // 无序列表
            html = html.replace(/^[\*\-] (.+)$/gm, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');

            // 有序列表
            html = html.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');

            // 引用
            html = html.replace(/^&gt; (.+)$/gm, '<blockquote>$1</blockquote>');
            html = html.replace(/(<blockquote>.*<\/blockquote>\n?)+/g, function(match) {
                return '<blockquote>' + match.replace(/<\/blockquote>\n?<blockquote>/g, '\n').replace(/<\/?blockquote>/g, '') + '</blockquote>';
            });

            // 分隔线
            html = html.replace(/^-{3,}$/gm, '<hr>');
            html = html.replace(/^\*{3,}$/gm, '<hr>');

            // 段落
            html = html.replace(/^(?!<[h|u|o|b|p|d])(.+)$/gm, '<p>$1</p>');

            // 换行
            html = html.replace(/\n\n/g, '</p>\n<p>');
            html = html.replace(/<p><(h[1-6]|ul|ol|blockquote|pre|hr)/g, '<$1');
            html = html.replace(/<\/(h[1-6]|ul|ol|blockquote|pre)><\/p>/g, '</$1>');

            // 清理多余的 p 标签
            html = html.replace(/<p>(<h[1-4]>)/g, '$1');
            html = html.replace(/(<\/h[1-4]>)<\/p>/g, '$1');
            html = html.replace(/<p>(<ul>)/g, '$1');
            html = html.replace(/(<\/ul>)<\/p>/g, '$1');
            html = html.replace(/<p>(<ol>)/g, '$1');
            html = html.replace(/(<\/ol>)<\/p>/g, '$1');
            html = html.replace(/<p>(<blockquote>)/g, '$1');
            html = html.replace(/(<\/blockquote>)<\/p>/g, '$1');
            html = html.replace(/<p>(<pre>)/g, '$1');
            html = html.replace(/(<\/pre>)<\/p>/g, '$1');
            html = html.replace(/<p>(<hr>)/g, '$1');
            html = html.replace(/(<hr>)<\/p>/g, '$1');

            // 空段落
            html = html.replace(/<p><\/p>/g, '');

            return html;
        }

        function escapeHtml(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function getHTML() {
            const markdown = document.getElementById('markdown-input').value;
            return parseMarkdown(markdown);
        }

        function copyHTML() {
            const html = getHTML();
            if (!html.trim()) {
                showToast('没有可复制的内容');
                return;
            }

            navigator.clipboard.writeText(html).then(() => {
                showToast('HTML 已复制到剪贴板');
            });
        }

        function downloadHTML() {
            const html = getHTML();
            if (!html.trim()) {
                showToast('没有可下载的内容');
                return;
            }

            const fullHtml = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 转换结果</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        h1, h2 { border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; }
        pre { background: #282c34; color: #abb2bf; padding: 15px; border-radius: 8px; overflow-x: auto; }
        pre code { background: none; padding: 0; color: inherit; }
        blockquote { border-left: 4px solid #ddd; margin: 1em 0; padding-left: 1em; color: #666; }
        a { color: #30cfd0; }
        img { max-width: 100%; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px 12px; }
        th { background: #f4f4f4; }
    </style>
</head>
<body>
${html}
</body>
</html>`;

            const blob = new Blob([fullHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'markdown-output.html';
            a.click();
            URL.revokeObjectURL(url);
            showToast('已开始下载');
        }

        async function pasteMarkdown() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('markdown-input').value = text;
                convert();
            } catch (err) {
                showToast('无法访问剪贴板');
            }
        }

        function clearAll() {
            document.getElementById('markdown-input').value = '';
            convert();
        }

        function loadExample() {
            document.getElementById('markdown-input').value = `# 欢迎使用 Markdown 编辑器

## 什么是 Markdown？

Markdown 是一种轻量级标记语言，让你可以使用**易读易写**的纯文本格式编写文档。

## 常用语法

### 文本样式

- **粗体文本**
- *斜体文本*
- ~~删除线~~
- \`行内代码\`

### 列表

无序列表：
- 项目 1
- 项目 2
  - 子项目 2.1
  - 子项目 2.2

有序列表：
1. 第一项
2. 第二项
3. 第三项

### 代码块

\`\`\`javascript
function hello() {
    console.log("Hello, World!");
}
\`\`\`

### 引用

> 这是一段引用文字。
> 可以有多行。

### 链接和图片

[访问 GitHub](https://github.com)

### 分隔线

---

## 开始编写你的 Markdown 吧！`;
            convert();
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #333;
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                z-index: 1000;
                animation: fadeInOut 2s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        // Add animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
                15% { opacity: 1; transform: translateX(-50%) translateY(0); }
                85% { opacity: 1; transform: translateX(-50%) translateY(0); }
                100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            }
        `;
        document.head.appendChild(style);

        // 初始化
        loadExample();
    </script>
</body>
</html>
